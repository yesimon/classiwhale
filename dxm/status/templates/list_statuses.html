<script type="text/javascript">
    function rate(kind, foundid) {
        $.post(
        "{% url status.views.ajax_rate %}", 
        { rating: kind, id: foundid }
        );
    }

    function rateLike() {
        $(this).unbind();
        rate("up", $(this).closest(".entry").attr("id")); 
        $(this).siblings().hide();
        $(this).closest(".entry").slideUp('', moveToRatings);	
    }

    function rateDislike() {
        $(this).unbind();
        rate("down", $(this).closest(".entry").attr("id")); 
        $(this).siblings().hide();
        $(this).closest(".entry").slideUp('', moveToRatings);	
    }

    function addRateLinkHandlers() {
	$(".status-container .like").click(rateLike);
	$(".status-container .dislike").click(rateDislike);
    }

    function moveToRatings() {
        $(this).
	prependTo($(".rating-container>.ratings")).slideDown();
    }

    function loadStatuses() {
    if ($(".status-container .entry").size() < 5)
        {
	$.get(
	"{% url status.views.ajax_recent_public_posts %}",
	function(data) {
	    $(data).appendTo($(".status-container")).slideDown();
	    addRateLinkHandlers();
	});
        } 
    }

    function autoRefreshStatuses() {
        setInterval("loadStatuses()", 5000);
    }

    function startJS() {
//        $(".hoverable").hover(
//            function() { $(this).addClass("hilite"); },
//            function() { $(this).removeClass("hilite"); }
//        ); -->
        addRateLinkHandlers();
	autoRefreshStatuses();
    }
    $(document).ready(startJS);	
</script>

{% endblock %} 

{% block content %} 
{% if errors %}
<ul>
	{% for error in errors %}
	<li>{{ error }}</li>
	{% endfor %}
</ul>
{% endif %}

<div class="status-container">

<h2>Recent Tweets</h2>

<div class="statuses">

{% for status in statuses %}

<div class="entry" id="{{ status.GetId }}">

<div class="rate-link"><a class="like hoverable">Like</a> <a
	class="dislike hoverable">Dislike</a></div>

<div class="tweet-usr-profile"><a
	href="http://twitter.com/{{ status.GetUser.GetScreenName }}"> <img
	class="photo" width="48" height="48"
	src="{{ status.GetUser.GetProfileImageUrl }}"
	alt="{{ status.GetUser.GetName }} " /> </a></div>

<div class="tweet-body">
<p><a class="twtr-user"
	href="http://twitter.com/{{ status.GetUser.GetScreenName }}">
	{{ status.GetUser.GetScreenName }} </a> {{ status.GetText }} <a
	class="tweet-hlink" href="http://twitpic.com/20seue" target="_blank"></a>

<i> <a class="tweet-timestamp"
	href="http://twitter.com/{{ status.GetUser.GetScreenName }}/status/{{ status.GetId }}"
	target="_blank">{{ status.GetRelativeCreatedAt }}</a> </i></p>
</div>

</div>

{% empty %} 
There are no posts to display. 
{% endfor %}

</div>

</div>

<div class="rating-container">
<h2>Ratings</h2>

<div class="ratings">

</div>

</div>



